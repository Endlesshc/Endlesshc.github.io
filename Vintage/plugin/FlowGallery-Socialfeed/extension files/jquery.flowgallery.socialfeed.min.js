/*! Social Feed - Extension for Flow Gallery jQuery plugin - 1.0.1
 * Copyright 2015, Nilok Bose
 * http://codecanyon.net/user/cosmocoder
*/
Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),a=this,s=function(){},i=function(){return a.apply(this instanceof s&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return s.prototype=this.prototype,i.prototype=new s,i}),"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),function(e,t,a){"use strict";var s={init:function(t,a){this.$elem=e(a),this.options=t;var s,i=this;"facebook"===this.options.feed?s=this.loadFacebookData():"instagram"===this.options.feed?s=this.loadInstagramData():"dribbble"===this.options.feed?s=this.loadDribbbleData():"pinterest"===this.options.feed&&(s=this.loadPinterestData()),s.done(function(t){var a=i.options;if(a.configData=t,a.configUrl="",a.enableCache=!1,("dribbble"===i.options.feed||"pinterest"===i.options.feed)&&(a.showFilterMenu=!1),i.$elem.flowGallery(a).addClass(i.options.feed),i.$elem.find("div.flow-menu").find('a[data-type="audio"]').hide(),"dribbble"===i.options.feed&&"user"!==i.options.dribbbleOptions.sourceType&&i.options.dribbbleOptions.showAvatar){var s="tile"===i.options.items.style?"div.card-image":"div.card-action";i.options.shuffleItems&&(t=i.shuffle(t)),i.$elem.on("onSetup",function(){i.$elem.find("div.item").each(function(a){e(this).find(s).append('<a class="user" href="'+t[a].user.url+'" title="'+t[a].user.name+'" target="_blank"><img src="'+t[a].user.avatar+'"/></a>')})})}})},getCache:function(t){var a=e.ajax({type:"post",data:{interval:this.options.cacheInterval,cacheFile:t+"-cache.json"},url:this.options.cacheFolder+"/get-cache.php",dataType:"json",global:!1});return a},updateCache:function(t,a){e.ajax({type:"post",data:{config:JSON.stringify(t),cacheFile:a+"-cache.json"},url:this.options.cacheFolder+"/update-cache.php",dataType:"json",global:!1})},loadFacebookData:function(){var t,a=this,s=a.options.facebookOptions,i=s.numberOfAlbums,o="",r="https://graph.facebook.com/",n=e.Deferred();return"photos"===s.sourceType?(r+=s.userID+"/photos/uploaded/?fields=name,description,created_time,images,likes.summary(true)&limit="+s.limit,o="facebook-"+s.userID+"-photos"):"videos"===s.sourceType?(r+=s.userID+"/videos/uploaded/?fields=name,description,created_time,format,source,likes.summary(true)&limit="+s.limit,o="facebook-"+s.userID+"-videos"):"album"===s.sourceType?(r+=s.albumID+"/photos/?fields=name,description,created_time,images,likes.summary(true)&limit="+s.limit,o="facebook-album-"+s.albumID):"albums"===s.sourceType&&(r+=s.userID+"/albums/?fields=name,cover_photo,count&limit="+s.numberOfAlbums,o="facebook-"+s.userID+"-albums"),r+="&access_token="+s.accessToken,a.options.enableCache?t=a.getCache(o):(t=e.Deferred(),t.resolve({expired:!0})),t.done(function(t){t.expired?e.ajax({url:r,dataType:"json",success:function(t){var r=[],c=[];t.error?t.error?a.fgLog("facebook: "+t.error.message):0===t.data.length&&a.fgLog("facebook: No photos/videos found"):("albums"===s.sourceType?(r={albums:[]},e.each(t.data,function(t){r.albums[t]={},r.albums[t].title=this.name;var o=e.ajax({url:"https://graph.facebook.com/"+this.id+"/photos/?fields=name,description,created_time,images,likes.summary(true)&limit="+s.limit,dataType:"json",success:function(e){r.albums[t].items=a.createFacebookSetData(e.data,"photo")}});return c.push(o),t===i-1?!1:void 0})):r="videos"===s.sourceType?a.createFacebookSetData(t.data,"video"):a.createFacebookSetData(t.data,"photo"),e.when.apply(e,c).done(function(){a.options.enableCache&&a.updateCache(r,o),n.resolve(r)}))}}):n.resolve(t)}),n},createFacebookSetData:function(t,a){var s=this,i=[];return 0===t.length?void s.fgLog("No items found"):(e.each(t,function(e,t){var o={},r=t.likes?t.likes.summary.total_count:0;"photo"===a?(o.type="photo",o.sort={date:(new Date).setTime(Date.parse(t.created_time)),likes:r},o.thumbnail=t.images[3]?t.images[3].source:t.images[t.images.length-1].source,o.source=t.images[0].source,o.title="",o.description=t.name?t.name:"&nbsp;"):(o.type="video",o.sort={date:(new Date).setTime(Date.parse(t.created_time)),likes:r},o.thumbnail=t.format[1].picture,o.mp4=t.source,t.name?(o.title=t.name,o.description=t.description?t.description:"&nbsp;"):(o.title="",o.description=t.description?t.description:"&nbsp;")),o.title+='<span class="meta"><span class="uploaded">'+s.formatDate(t.created_time)+'</span><span class="likes"><i class="mdi-action-thumb-up"></i> '+s.formatNumber(r)+"</span></span>",i.push(o)}),i)},loadInstagramData:function(){var t,a=this,s=a.options.instagramOptions,i="",o="https://api.instagram.com/v1/",r=e.Deferred();return"user"===s.sourceType?(o+="users/"+s.userID+"/media/recent/?access_token="+s.accessToken+"&count="+s.limit+"&callback=?",i="instagram-user-"+s.userID):"popular"===s.sourceType?(o+="media/popular?access_token="+s.accessToken+"&count="+s.limit+"&callback=?",i="instagram-popular"):"tag"===s.sourceType&&(o+="tags/"+s.tag+"/media/recent/?access_token="+s.accessToken+"&count="+s.limit+"&callback=?",i="instagram-tag-"+s.tag),a.options.enableCache?t=a.getCache(i):(t=e.Deferred(),t.resolve({expired:!0})),t.done(function(t){t.expired?e.ajax({url:o,dataType:"jsonp",timeout:5e3,success:function(t){if(!t.data)return void a.fgLog("Instagram request failed");var o=[];e.each(t.data,function(e){o[e]={},"image"===this.type?(o[e].type="photo",o[e].source=this.images.standard_resolution.url):"video"===this.type&&(o[e].type="video",o[e].mp4=this.videos.standard_resolution.url),o[e].sort={date:parseInt(this.created_time,10),likes:this.likes.count},o[e].thumbnail=this.images[s.thumbSize].url,o[e].title='<span class="meta">',o[e].title+='<span class="uploaded">'+a.formatDate(1e3*parseInt(this.created_time,10))+"</span>",o[e].title+='<span class="likes"><i class="mdi-action-favorite"></i> '+a.formatNumber(this.likes.count)+"</span>",o[e].title+="</span>",o[e].description=this.caption?this.caption.text:"&nbsp;"}),a.options.enableCache&&a.updateCache(o,i),r.resolve(o)}}):r.resolve(t)}),r},loadDribbbleData:function(){var t,a=this,s=a.options.dribbbleOptions,i="",o="https://api.dribbble.com/v1/",r=e.Deferred();return"user"===s.sourceType?(o+="users/"+s.userID+"/shots/?access_token="+s.accessToken+"&per_page="+s.limit+"&callback=?",i="dribbble-user-"+s.userID):"list"===s.sourceType?(o+="shots/?access_token="+s.accessToken+"&list="+s.listName+"&per_page="+s.limit+"&callback=?",i="dribbble-list-"+s.listName):"bucket"===s.sourceType?(o+="buckets/"+s.bucketID+"/shots/?access_token="+s.accessToken+"&per_page="+s.limit+"&callback=?",i="dribbble-bucket-"+s.bucketID):"project"===s.sourceType&&(o+="projects/"+s.projectID+"/shots/?access_token="+s.accessToken+"&per_page="+s.limit+"&callback=?",i="dribbble-project-"+s.projectID),a.options.enableCache?t=a.getCache(i):(t=e.Deferred(),t.resolve({expired:!0})),t.done(function(t){t.expired?e.ajax({url:o,dataType:"jsonp",timeout:5e3,success:function(t){if(!t.data)return void a.fgLog("Dribbble request failed");var o=[];e.each(t.data,function(e){o[e]={},o[e].type="photo",o[e].sort={date:(new Date).setTime(Date.parse(this.created_at)),likes:this.likes_count,views:this.views_count},"user"!==s.sourceType&&(o[e].user={avatar:this.user.avatar_url,name:this.user.name,url:this.user.html_url}),o[e].source=this.images.hidpi,o[e].thumbnail=this.images.normal,o[e].title=this.title+'<span class="meta"><span class="views"><i class="mdi-action-visibility"></i> '+a.formatNumber(this.views_count)+'</span><span class="likes"><i class="mdi-action-favorite"></i> '+a.formatNumber(this.likes_count)+"</span></span>",o[e].description=this.description?this.description.replace(/(<p>)/g,"").replace(/(<\/p>)/g,"<br><br>"):"&nbsp;",o[e].description+='<span class="uploaded">'+a.formatDate(this.created_at)+"</span>"}),a.options.enableCache&&a.updateCache(o,i),r.resolve(o)}}):r.resolve(t)}),r},loadPinterestData:function(){var t,a=this,s=a.options.pinterestOptions,i="",o="https://api.pinterest.com/v3/pidgets/",r=e.Deferred();return"user"===s.sourceType?(o+="users/"+s.userID+"/pins/?limit="+s.limit+"&callback=?",i="pinterest-user-"+s.userID):"board"===s.sourceType&&(o+="boards/"+s.userID+"/"+s.boardID+"/pins/?limit="+s.limit+"&callback=?",i="pinterest-board-"+s.boardID),a.options.enableCache?t=a.getCache(i):(t=e.Deferred(),t.resolve({expired:!0})),t.done(function(t){t.expired?e.ajax({url:o,dataType:"jsonp",timeout:5e3,success:function(t){if(!t.data)return void a.fgLog("Pinterest request failed");var o=[];e.each(t.data.pins,function(e){return o[e]={},o[e].type="photo",o[e].sort={likes:this.like_count},o[e].source=this.images["237x"].url.replace("237x","originals"),o[e].thumbnail=this.images["237x"].url,o[e].title=this.description,o[e].title+=this.like_count>0?'<span class="meta"><span class="likes"><i class="mdi-action-favorite"></i> '+a.formatNumber(this.like_count)+"</span></span>":"",o[e].description="&nbsp;",e===s.limit-1?!1:void 0}),a.options.enableCache&&a.updateCache(o,i),r.resolve(o)}}):r.resolve(t)}),r},formatDate:function(e){var t=new Date(isNaN(e)?Date.parse(e):e),a=t.getUTCDate(),s=t.getUTCMonth(),i=t.getUTCFullYear(),o=["January","February","March","April","May","June","July","August","September","October","November","December"];return o[s]+" "+a+", "+i},formatNumber:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},shuffle:function(e){for(var t,a,s=e.length;s;t=parseInt(Math.random()*s,10),a=e[--s],e[s]=e[t],e[t]=a);return e},fgLog:function(){a.console&&a.console.log?console.log("[flowGallery] "+Array.prototype.slice.call(arguments)):alert("[flowGallery] "+Array.prototype.slice.call(arguments).join("<br>"))}};e.fn.flowGallerySocialFeed=function(t){var a=e.extend(!0,{},e.fn.flowGallery.defaults,e.fn.flowGallerySocialFeed.defaults,t);return e.isArray(t.sortBy)&&(a.sortBy=t.sortBy),this.each(function(){if(!e.data(this,"flowGallerySocialFeed")){var t=Object.create(s);t.init(a,this),e.data(this,"flowGallerySocialFeed",!0)}})},e.fn.flowGallerySocialFeed.defaults={feed:"facebook",sortBy:["title","date","likes"],facebookOptions:{accessToken:"",sourceType:"photos",albumID:"",userID:"",limit:30,numberOfAlbums:30},instagramOptions:{accessToken:"",sourceType:"user",userID:"",tag:"",limit:30,thumbSize:"low_resolution"},dribbbleOptions:{accessToken:"",sourceType:"user",userID:"",bucketID:"",projectID:"",listName:"popular",showAvatar:!0,limit:30},pinterestOptions:{sourceType:"user",userID:"",boardID:"",limit:30}}}(jQuery,document,window);